<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de" th:lang="${lang}">
  <head
    th:replace="~{timeentries/_layout::head(~{::title}, ~{::scriptsSynchrounous}, ~{::scriptsDeferred}, ~{})}"
  >
    <title>Zeiterfassung</title>
    <th:block th:fragment="scriptsSynchrounous">
      <script th:replace="~{fragments/i18n::date-picker}"></script>
      <script th:replace="~{fragments/i18n::time-entry}"></script>
      <script th:replace="~{fragments/i18n::time-slot-validation}"></script>
    </th:block>
    <th:block th:fragment="scriptsDeferred">
      <script
        type="module"
        src=""
        th:src="@{/assets/date-fns-localized.js}"
      ></script>
      <script type="module" src="" th:src="@{/assets/time-entries.js}"></script>
    </th:block>
  </head>
  <body th:replace="~{timeentries/_layout::body(~{::content})}">
    <th:block
      th:fragment="content"
      th:with="noTimeEntriesYet=${timeEntryWeeksPage.totalTimeEntryElements eq 0}"
    >
      <main class="flex-1 flex flex-col">
        <div class="mx-auto w-full max-w-screen-lg mb-16 md:mb-28">
          <div class="px-4">
            <h1
              class="text-2xl text-blue-700 text-center mb-4"
              th:text="#{time-entry.create.title}"
            >
              Neuen Zeitslot erfassen
            </h1>
            <th:block
              th:insert="~{::timeentry-slot-form(formAction=@{/timeentries}, timeEntry=${timeEntry}, actions=~{::timeentry-slot-form-actions-new}, class='timeslot-form-new')}"
            ></th:block>
          </div>
        </div>
        <div
          th:if="${noTimeEntriesYet}"
          class="flex-1 mx-auto w-full max-w-screen-lg flex flex-col"
        >
          <div class="-translate-y-12 md:-translate-y-16">
            <div class="mb-8 md:mb-16 flex justify-center">
              <img
                src="#"
                th:src="@{/images/create-first-timeslot-arrow.svg}"
                width="147px"
                height="60px"
                class="md:ml-auto mr-36 md:mr-48 w-28 md:w-auto"
              />
            </div>
            <p
              class="text-xl xs:text-4xl text-center"
              th:text="#{time-entry.no-entries-available}"
            >
              Noch keine Zeitslots erfasst
            </p>
          </div>
          <div class="sloth-background flex-1"></div>
        </div>
        <turbo-frame id="frame-time-entry">
          <th:block th:if="${turboEditedTimeEntry != null}">
            <turbo-stream
              action="replace"
              th:target="${'calendar-week-title-sum-'+ calendarWeek}"
            >
              <template
                th:insert="::calendar-week-title-sum(${workedHoursSumWeek}, ${calendarWeek})"
              ></template>
            </turbo-stream>
            <turbo-stream
              action="replace"
              th:target="${'calendar-day-title-sum-'+ calendarWeek + '-' + turboEditedTimeEntry.date.dayOfWeek}"
            >
              <template
                th:insert="::calendar-week-day-title-sum(${workedHoursSumDay}, ${calendarWeek}, ${turboEditedTimeEntry.date.dayOfWeek})"
              ></template>
            </turbo-stream>
            <turbo-stream
              action="replace"
              th:target="${'time-entry-' + turboEditedTimeEntry.id}"
            >
              <template
                th:insert="~{::time-entry-element(${turboEditedTimeEntry})}"
              ></template>
            </turbo-stream>
          </th:block>
        </turbo-frame>
        <turbo-frame id="frame-time-entry-weeks">
          <th:block
            th:if="${not (turboStreamsEnabled eq null) and turboStreamsEnabled eq true}"
          >
            <turbo-stream action="append" target="time-entries-box">
              <template th:insert="~{::time-entries-box-content}"></template>
            </turbo-stream>
            <turbo-stream action="replace" target="load-more-button">
              <template th:insert="~{::#load-more-button}"></template>
            </turbo-stream>
          </th:block>
        </turbo-frame>
        <div
          th:if="${not noTimeEntriesYet}"
          class="mx-auto w-full max-w-screen-lg space-y-16"
          th:classappend="${timeEntryWeeksPage.totalTimeEntryElements eq 0 ? 'mb-8' : ''}"
        >
          <div id="time-entries-box" class="space-y-16">
            <th:block th:ref="time-entries-box-content">
              <div
                class="space-y-2"
                th:with="week=${timeEntryWeeksPage.timeEntryWeek}"
              >
                <div class="px-4">
                  <div
                    th:fragment="calendar-week-title"
                    class="flex items-center"
                  >
                    <div
                      class="flex-1 relative py-1 px-4 bg-green-100 w-full rounded-full"
                    >
                      <div
                        class="absolute left-0 top-0 bottom-0 bg-green-300 rounded-full"
                        style="width: 75%"
                      ></div>
                      <div
                        class="relative flex flex-col justify-between text-green-800 text-sm xs:flex-row"
                      >
                        <h3 class="relative text-green-800 text-sm">
                          <span
                            class="font-medium"
                            th:text="#{time-entry.overview.week.group.title.date-range(${week.calendarWeek}, ${week.from}, ${week.to})}"
                          ></span>
                        </h3>
                        <p
                          th:if="${not #lists.isEmpty(week.timeEntries)}"
                          th:with="hoursWorked=${week.hoursWorked}, calendarWeek=${week.calendarWeek}"
                        >
                          <span class="sr-only sm:not-sr-only">Woche:</span>
                          <span
                            th:fragment="calendar-week-title-sum(hoursWorked, calendarWeek)"
                            th:id="${'calendar-week-title-sum-'+ calendarWeek}"
                            class="font-bold proportional-nums"
                            th:text="${hoursWorked}"
                          ></span>
                          (<span class="sr-only sm:not-sr-only">Soll: </span
                          ><span class="font-bold proportional-nums">40:00</span
                          >)
                        </p>
                      </div>
                    </div>
                    <div
                      class="sr-only xs:not-sr-only xs:text-green-500 xs:ml-2 md:ml-4 md:w-1/5 lg:w-1/6"
                    >
                      + 05:45
                    </div>
                  </div>
                </div>
                <div th:if="${#lists.isEmpty(week.timeEntries)}">
                  <p
                    class="m-8"
                    th:text="#{time-entry.no-entries-available.week}"
                  >
                    In dieser Woche sind keine Einträge vorhanden.
                  </p>
                </div>
                <div
                  th:if="${not #lists.isEmpty(week.timeEntries())}"
                  class="space-y-10 md:space-y-4"
                >
                  <th:block th:each="day: ${week.days}">
                    <div class="px-4 sticky top-nav-header pt-px z-10">
                      <div class="flex items-center">
                        <div
                          class="flex-1 relative py-1 px-4 bg-green-100 w-full rounded-full"
                        >
                          <div
                            class="absolute left-0 top-0 bottom-0 bg-green-300 rounded-full"
                            style="width: 24%"
                          ></div>
                          <div
                            class="relative flex flex-col justify-between text-green-800 text-sm xs:flex-row"
                          >
                            <h4
                              class="font-medium"
                              th:text="${day.date()}"
                            ></h4>
                            <p
                              th:if="${not #lists.isEmpty(day.timeEntries)}"
                              th:with="hoursWorked=${day.hoursWorked()}, calendarWeek=${week.calendarWeek()}, day=${day.timeEntries[0].date.dayOfWeek}"
                              class="text-gray-600"
                            >
                              <span class="sr-only sm:not-sr-only">Tag:</span>
                              <span
                                th:fragment="calendar-week-day-title-sum(hoursWorked, calendarWeek, day)"
                                th:id="${'calendar-day-title-sum-' + calendarWeek + '-' + day}"
                                class="font-bold proportional-nums"
                                th:text="${hoursWorked}"
                              ></span>
                              (<span class="sr-only sm:not-sr-only">Soll: </span
                              ><span class="font-bold proportional-nums"
                                >08:00</span
                              >)
                            </p>
                          </div>
                        </div>
                        <div
                          class="sr-only xs:not-sr-only xs:text-green-500 xs:ml-2 md:ml-4 md:w-1/5 lg:w-1/6"
                        >
                          + 01:30
                        </div>
                      </div>
                    </div>
                    <div class="px-4 space-y-10 md:space-y-2">
                      <th:block th:each="timeEntry: ${day.timeEntries}">
                        <div
                          is="z-time-entry-element"
                          th:fragment="time-entry-element(timeEntry)"
                          th:with="formAction=@{/timeentries/{id} (id=${timeEntry.id})}"
                          th:id="${'time-entry-' + timeEntry.id}"
                          th:data-date="${#temporals.format(timeEntry.date, 'EEEE, dd. MMMM')}"
                          th:data-duration="${timeEntry.duration}"
                          th:insert="~{::timeentry-slot-form(formAction=${formAction}, timeEntry=${timeEntry}, actions=~{::timeentry-slot-form-actions-existing(${timeEntry})}, class='timeslot-form-existing')}"
                          data-turbo="true"
                        ></div>
                      </th:block>
                    </div>
                  </th:block>
                </div>
              </div>
            </th:block>
          </div>
          <nav class="mt-16">
            <noscript>
              <ul class="ml-6 flex gap-8">
                <li>
                  <a
                    href="#"
                    th:href="@{/timeentries/{year}/{week} (year=${timeEntryWeeksPage.pastYear}, week=${timeEntryWeeksPage.pastWeekOfYear})}"
                    class="text-lg font-bold mx-auto px-4 py-2 inline-block border border-blue-600 text-blue-600 rounded-full"
                    th:text="#{time-entry.pagination.past}"
                  >
                    Zurück in die Vergangenheit
                  </a>
                </li>
                <li>
                  <a
                    href="#"
                    th:href="@{/timeentries}"
                    class="text-lg font-bold mx-auto px-4 py-2 inline-block border border-blue-600 text-blue-600 rounded-full"
                    th:text="#{time-entry.pagination.today}"
                  >
                    Heutige Kalenderwoche
                  </a>
                </li>
                <li>
                  <a
                    href="#"
                    th:href="@{/timeentries/{year}/{week} (year=${timeEntryWeeksPage.futureYear}, week=${timeEntryWeeksPage.futureWeekOfYear})}"
                    class="text-lg font-bold mx-auto px-4 py-2 inline-block border border-blue-600 text-blue-600 rounded-full"
                    th:text="#{time-entry.pagination.future}"
                  >
                    Weiter in die Zukunft
                  </a>
                </li>
              </ul>
            </noscript>
            <div hidden data-js-no-hidden class="text-center" data-turbo="true">
              <a
                id="load-more-button"
                href="#"
                th:href="@{/timeentries/{year}/{week} (year=${timeEntryWeeksPage.pastYear}, week=${timeEntryWeeksPage.pastWeekOfYear})}"
                class="ajax-loader text-lg font-medium mx-auto px-4 py-2 inline-block border border-blue-600 text-blue-600 rounded-full"
                data-turbo-frame="frame-time-entry-weeks"
                th:text="#{time-entry.pagination.load-more}"
              >
                Mehr Einträge anzeigen
              </a>
            </div>
          </nav>
        </div>
      </main>
    </th:block>

    <template id="z-template-zeitslot">
      <form
        th:fragment="timeentry-slot-form(formAction, timeEntry, actions, class)"
        is="z-time-entry-slot-form"
        action="#"
        th:action="${formAction}"
        method="post"
        class="flex flex-col-reverse md:flex-col"
        th:classappend="${class}"
        th:with="rnd=${#strings.randomAlphanumeric(6)}"
        th:object="${timeEntry}"
      >
        <h4
          class="sr-only"
          th:text="${#temporals.format(timeEntry.date, 'dd. MMMM yyyy')}"
        ></h4>
        <div class="flex flex-col md:flex-row">
          <div class="flex-1 flex flex-col md:flex-row">
            <div
              is="z-time-entry-date-picker"
              class="flex flex-col items-center bg-timeslot-form-datepicker text-timeslot-form-day py-6 px-5 rounded-t-[27px] md:rounded-tr-none md:rounded-l-[27px] md:w-56 border-r-timeslot-form"
              data-js-class-remove="flex-col"
            >
              <input
                type="date"
                id="input-entry-date"
                th:id="|${rnd}-input-entry-date|"
                name="date"
                class="text-black"
                value="2021-11-27"
                th:value="${#temporals.format(timeEntry.date, 'yyyy-MM-dd')}"
                data-iso-value="2021-11-27"
                th:data-iso-value="${#temporals.format(timeEntry.date, 'yyyy-MM-dd')}"
                data-js-hidden
              />
              <label
                for="input-entry-date"
                th:for="|${rnd}-input-entry-date|"
                class="w-full flex cursor-pointer"
              >
                <span
                  data-day
                  class="rounded-full w-6 h-6 p-5 flex items-center justify-center bg-timeslot-form-day text-black mr-4 font-bold"
                  th:text="${#temporals.day(timeEntry.date)}"
                >
                  21
                </span>
                <span class="flex-1 flex flex-col text-sm">
                  <span
                    data-day-text
                    class="font-semibold"
                    th:with="dayOfWeekName=${#temporals.dayOfWeekName(timeEntry.date)}"
                    th:text="${timeEntry.today ? #messages.msg('datepicker.today') + ', ' + dayOfWeekName : dayOfWeekName}"
                  >
                    Heute, Sonntag
                  </span>
                  <span
                    data-date
                    th:text="${#temporals.format(timeEntry.date, 'dd. MMMM yyyy')}"
                    class="whitespace-nowrap"
                  >
                    21. November 2021
                  </span>
                </span>
              </label>
            </div>
            <div class="flex flex-col md:flex-row flex-1">
              <svg
                class="hidden md:block h-full text-timeslot-form-datepicker-background border border-timeslot-form border-l-0 border-r-0"
                width="28"
                height="76"
                viewBox="0 0 28 76"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                preserveAspectRatio="none"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M0 76C36.4259 46.2385 36.507 29.5983 0 0V76Z"
                  fill="currentColor"
                />
              </svg>
              <div
                class="ajax-loader flex-1 border md:border-l-0 border-timeslot-form rounded-b-3xl md:rounded-b-none md:rounded-r-3xl flex items-center"
              >
                <div class="time-entry-cell-container">
                  <div class="time-entry-cell time-entry-cell__comment">
                    <input
                      type="text"
                      id="input-entry-comment"
                      th:id="|${rnd}-input-entry-comment|"
                      name="comment"
                      th:value="${timeEntry.comment}"
                      placeholder="Woran arbeitest du gerade?"
                      th:placeholder="#{time-entry.form.comment.input.placeholder}"
                    />
                    <label
                      for="input-entry-comment"
                      th:for="|${rnd}-input-entry-comment|"
                      th:text="#{time-entry.form.comment.label}"
                    >
                      Kommentar
                    </label>
                  </div>
                  <div class="time-entry-cell time-entry-cell__from">
                    <input
                      type="time"
                      id="input-entry-from"
                      th:id="|${rnd}-input-entry-from|"
                      name="start"
                      th:value="${timeEntry.start}"
                      placeholder="Von"
                      th:placeholder="#{time-entry.form.start.input.placeholder}"
                      class="peer invalid:border-red-600"
                      th:classappend="${#fields.hasErrors('start') && timeEntryErrorId == timeEntry.id ? 'border-b border-red-600' : ''}"
                    />
                    <label
                      for="input-entry-from"
                      th:for="|${rnd}-input-entry-from|"
                      class="peer-invalid:text-red-600"
                      th:classappend="${#fields.hasErrors('start') && timeEntryErrorId == timeEntry.id ? 'text-red-600' : ''}"
                      th:text="#{time-entry.form.start.label}"
                    >
                      Von
                    </label>
                  </div>
                  <div class="time-entry-cell time-entry-cell__to">
                    <input
                      type="time"
                      id="input-entry-to"
                      th:id="|${rnd}-input-entry-to|"
                      name="end"
                      th:value="${timeEntry.end}"
                      placeholder="Bis"
                      th:placeholder="#{time-entry.form.end.input.placeholder}"
                      class="peer invalid:border-red-600"
                      th:classappend="${#fields.hasErrors('end') && timeEntryErrorId == timeEntry.id ? 'border-b border-red-600' : ''}"
                    />
                    <label
                      for="input-entry-to"
                      th:for="|${rnd}-input-entry-to|"
                      class="peer-invalid:text-red-600"
                      th:classappend="${#fields.hasErrors('end') && timeEntryErrorId == timeEntry.id ? 'text-red-600' : ''}"
                      th:text="#{time-entry.form.end.label}"
                    >
                      Bis
                    </label>
                  </div>
                  <div class="time-entry-cell time-entry-cell__duration">
                    <input
                      type="text"
                      id="input-entry-duration"
                      th:id="|${rnd}-input-entry-duration|"
                      name="duration"
                      th:value="${timeEntry.duration}"
                      placeholder="hh:mm"
                      th:placeholder="#{time-entry.form.duration.input.placeholder}"
                      class="peer invalid:border-red-600"
                      th:classappend="${#fields.hasErrors('duration') && timeEntryErrorId == timeEntry.id ? 'border-b border-red-600' : ''}"
                    />
                    <label
                      for="input-entry-duration"
                      th:for="|${rnd}-input-entry-duration|"
                      class="peer-invalid:text-red-600"
                      th:classappend="${#fields.hasErrors('duration') && timeEntryErrorId == timeEntry.id ? 'text-red-600' : ''}"
                      th:text="#{time-entry.form.duration.label}"
                    >
                      Dauer
                    </label>
                  </div>
                  <div class="time-entry-cell time-entry-cell__break">
                    <span class="checkbox-switch">
                      <input
                        type="checkbox"
                        id="input-entry-is-break"
                        th:id="|${rnd}-input-entry-is-break|"
                        name="break"
                        th:checked="${timeEntry.isBreak}"
                        class="peer mt-0.5"
                      />
                    </span>
                    <label
                      for="input-entry-is-break"
                      th:for="|${rnd}-input-entry-is-break|"
                      th:text="#{time-entry.form.is-break.label}"
                    >
                      Pause
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            class="mt-4 flex items-center justify-center md:justify-start md:ml-4 md:w-1/5 md:mt-0 lg:w-1/6"
            th:insert="${actions}"
          ></div>
        </div>
        <div
          class="text-red-600 text-center"
          data-error-container
          xtra:strip-whitespace="deep"
        >
          <ul th:if="${#fields.hasGlobalErrors()}">
            <li th:each="err : ${#fields.globalErrors()}" th:text="${err}">
              Etwas stimmt nicht, Jim.
            </li>
          </ul>
        </div>
      </form>
    </template>

    <template id="z-template-zeitslot-actions-new">
      <th:block th:fragment="timeentry-slot-form-actions-new">
        <button
          type="submit"
          class="mr-4 flex items-center justify-center text-blue-700 md:rounded-full md:w-12 md:h-12 hover:md:bg-blue-100 transition-colors duration-200"
        >
          <svg
            th:replace="~{icons/plus::svg(className='w-6 h-6 md:w-10 md:h-10 stroke-2 md:stroke-1')}"
          ></svg>
          <span class="ml-2 md:sr-only" th:text="#{time-entry.form.create}">
            Eintragen
          </span>
        </button>
        <span class="mr-4 md:block md:w-12" data-js-hidden></span>
        <span class="md:block md:w-12"></span>
      </th:block>
    </template>

    <template id="z-template-zeitslot-actions-existing">
      <th:block th:fragment="timeentry-slot-form-actions-existing(timeEntry)">
        <button
          type="reset"
          class="mr-4 flex items-center justify-center text-gray-500 md:text-gray-300 md:hover:text-gray-700 md:rounded-full md:w-12 md:h-12 hover:md:bg-blue-100 transition-colors duration-200"
          title="Zurücksetzen"
          th:title="#{time-entry.form.reset.tooltip}"
          data-js-hidden
        >
          <svg
            th:replace="~{icons/refresh::svg(className='w-5 h-5 md:w-6 md:h-6')}"
          ></svg>
          <span class="ml-2 md:sr-only" th:text="#{time-entry.form.reset}">
            Zurücksetzen
          </span>
        </button>
        <button
          type="submit"
          class="mr-4 flex items-center justify-center text-gray-500 md:text-gray-300 md:hover:text-gray-700 md:rounded-full md:w-12 md:h-12 hover:md:bg-blue-100 transition-colors duration-200"
          title="Speichern"
          th:title="#{time-entry.form.save.tooltip}"
          data-turbo-frame="frame-time-entry"
        >
          <svg
            th:replace="~{icons/save::svg(className='w-5 h-5 md:w-6 md:h-6')}"
          ></svg>
          <span class="ml-2 md:sr-only" th:text="#{time-entry.form.save}">
            Speichern
          </span>
        </button>
        <button
          type="button"
          name="delete"
          class="flex items-center justify-center text-gray-500 md:text-gray-300 md:hover:text-gray-700 md:rounded-full md:w-12 md:h-12 hover:md:bg-blue-100 transition-colors duration-200"
          title="Löschen"
          th:title="#{time-entry.form.delete.tooltip}"
        >
          <svg
            th:replace="~{icons/trash::svg(className='w-5 h-5 md:w-6 md:h-6')}"
          ></svg>
          <span class="ml-2 md:sr-only" th:text="#{time-entry.form.delete}">
            Löschen
          </span>
        </button>
      </th:block>
    </template>
  </body>
</html>
